--- #Koality: 1337
setup:
- scripts:
  # prepare database
  - psql -U postgres -c "SELECT 1 FROM pg_user WHERE usename='koality'" | grep -q 1 || psql -U postgres -c "CREATE USER koality PASSWORD 'lt3' SUPERUSER"
  - psql -U postgres -c "SELECT 1 FROM pg_database WHERE datname='koality'" | grep -q 1 || createdb -U postgres koality --template template0 --locale en_US.utf8 --encoding UTF8
  #  pull down missing submodules
  - git submodule update --init --recursive
  # install go
  - curl -L https://go.googlecode.com/files/go1.2.linux-amd64.tar.gz -s -o - | tar -C /usr/local -xzf -
  - echo 'export GOPATH=$HOME/koality-v1/code/back' >> /home/lt3/.bash_profile
  - echo 'export GOBIN=$GOPATH/bin' >> /home/lt3/.bash_profile
  - echo 'export PATH=$PATH:/usr/local/go/bin:$GOBIN' >> /home/lt3/.bash_profile
test:
  machines: 1
  factories:
  - koality test factory:
      script:
      - |
        cd code/back/src/koality
        ls -d */ | while read testDirectory; do
          echo - ${testDirectory%?}:
          echo "    script: go test koality/$testDirectory..."
        done
